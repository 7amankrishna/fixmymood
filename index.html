<!DOCTYPE html>
<html lang="en">
<head>
    <script>
setTimeout(() => {
    window.location.href = "chat.html";
}, 2000); // 2 seconds
</script>
    <script>
        function goToChat() {
            window.location.href = "chat.html";
        }
    </script>
    
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Fix My Mood</title>
<style>
    
    
    
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  :root {
    --bg-primary: #0a0a1a;
    --bg-secondary: #111128;
    --bg-card: rgba(255,255,255,0.05);
    --text-primary: #ffffff;
    --text-secondary: #8888aa;
    --accent-1: #6c5ce7;
    --accent-2: #a855f7;
    --accent-3: #06b6d4;
    --glow: rgba(108,92,231,0.3);
    --glass: rgba(255,255,255,0.08);
    --glass-border: rgba(255,255,255,0.12);
    --sad: #5b9bd5;
    --angry: #e74c3c;
    --anxious: #f39c12;
    --tired: #8e8e93;
    --normal: #2ecc71;
    --nav-height: 72px;
  }

  body {
    font-family: 'Inter', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    overflow-x: hidden;
    -webkit-tap-highlight-color: transparent;
  }

  .bg-particles {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    pointer-events: none;
    overflow: hidden;
  }

  .bg-particles .orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.4;
    animation: floatOrb 20s infinite ease-in-out;
  }

  .bg-particles .orb:nth-child(1) {
    width: 300px; height: 300px;
    background: var(--accent-1);
    top: -100px; left: -50px;
  }

  .bg-particles .orb:nth-child(2) {
    width: 400px; height: 400px;
    background: var(--accent-2);
    bottom: -150px; right: -100px;
    animation-delay: -7s;
  }

  .bg-particles .orb:nth-child(3) {
    width: 200px; height: 200px;
    background: var(--accent-3);
    top: 50%; left: 50%;
    animation-delay: -14s;
  }

  @keyframes floatOrb {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(50px, -80px) scale(1.1); }
    50% { transform: translate(-30px, 60px) scale(0.9); }
    75% { transform: translate(70px, 30px) scale(1.05); }
  }

  .app-container {
    position: relative;
    z-index: 1;
    max-width: 480px;
    margin: 0 auto;
    min-height: 100vh;
    padding-bottom: calc(var(--nav-height) + 20px);
  }

  .app-header {
    padding: 20px 24px 10px;
    text-align: center;
  }

  .app-header .logo {
    font-size: 28px;
    font-weight: 900;
    background: linear-gradient(135deg, #6c5ce7, #a855f7, #06b6d4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -0.5px;
  }

  .app-header .tagline {
    font-size: 12px;
    color: var(--text-secondary);
    margin-top: 2px;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .page {
    display: none;
    padding: 10px 20px 30px;
    animation: fadeInPage 0.4s ease;
  }

  .page.active { display: block; }

  @keyframes fadeInPage {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .section-title {
    font-size: 20px;
    font-weight: 700;
    margin: 20px 0 6px;
  }

  .section-subtitle {
    font-size: 13px;
    color: var(--text-secondary);
    margin-bottom: 18px;
    line-height: 1.5;
  }

  .glass-card {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 20px;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    margin-bottom: 16px;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .glass-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(108,92,231,0.15);
  }

  .greeting {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .greeting-sub {
    color: var(--text-secondary);
    font-size: 14px;
    margin-bottom: 24px;
  }

  .mood-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 12px;
  }

  .mood-btn {
    background: var(--glass);
    border: 2px solid transparent;
    border-radius: 20px;
    padding: 20px 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
  }

  .mood-btn::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    opacity: 0;
    transition: opacity 0.3s;
    border-radius: 18px;
  }

  .mood-btn[data-mood="sad"]::before { background: linear-gradient(135deg, rgba(91,155,213,0.2), rgba(91,155,213,0.05)); }
  .mood-btn[data-mood="angry"]::before { background: linear-gradient(135deg, rgba(231,76,60,0.2), rgba(231,76,60,0.05)); }
  .mood-btn[data-mood="anxious"]::before { background: linear-gradient(135deg, rgba(243,156,18,0.2), rgba(243,156,18,0.05)); }
  .mood-btn[data-mood="tired"]::before { background: linear-gradient(135deg, rgba(142,142,147,0.2), rgba(142,142,147,0.05)); }
  .mood-btn[data-mood="normal"]::before { background: linear-gradient(135deg, rgba(46,204,113,0.2), rgba(46,204,113,0.05)); }

  .mood-btn.selected::before { opacity: 1; }
  .mood-btn.selected[data-mood="sad"] { border-color: var(--sad); box-shadow: 0 0 20px rgba(91,155,213,0.3); }
  .mood-btn.selected[data-mood="angry"] { border-color: var(--angry); box-shadow: 0 0 20px rgba(231,76,60,0.3); }
  .mood-btn.selected[data-mood="anxious"] { border-color: var(--anxious); box-shadow: 0 0 20px rgba(243,156,18,0.3); }
  .mood-btn.selected[data-mood="tired"] { border-color: var(--tired); box-shadow: 0 0 20px rgba(142,142,147,0.3); }
  .mood-btn.selected[data-mood="normal"] { border-color: var(--normal); box-shadow: 0 0 20px rgba(46,204,113,0.3); }

  .mood-btn .emoji {
    font-size: 40px;
    display: block;
    margin-bottom: 8px;
    transition: transform 0.3s;
  }

  .mood-btn.selected .emoji { transform: scale(1.15); }

  .mood-btn .mood-label {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .mood-btn.full-width { grid-column: 2; }

  .fix-btn {
    width: 100%;
    padding: 18px;
    border: none;
    border-radius: 16px;
    background: linear-gradient(135deg, #6c5ce7, #a855f7);
    color: white;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    margin-top: 8px;
    transition: all 0.3s;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
  }

  .fix-btn::after {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
    transition: left 0.5s;
  }

  .fix-btn:hover::after { left: 100%; }
  .fix-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(108,92,231,0.4);
  }

  .fix-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
  }

  .fix-result {
    display: none;
    animation: fadeInPage 0.5s ease;
  }

  .fix-result.active { display: block; }

  .fix-header {
    text-align: center;
    margin-bottom: 24px;
  }

  .fix-header .fix-emoji {
    font-size: 60px;
    display: block;
    margin-bottom: 8px;
    animation: bounceIn 0.6s ease;
  }

  @keyframes bounceIn {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }

  .fix-header h2 { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
  .fix-header p { color: var(--text-secondary); font-size: 13px; }

  .fix-card {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 14px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .fix-card:hover {
    transform: translateY(-2px);
    background: rgba(255,255,255,0.08);
  }

  .fix-card .fix-card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 8px;
  }

  .fix-card .fix-icon {
    width: 44px; height: 44px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
  }

  .fix-card .fix-card-title { font-size: 15px; font-weight: 600; }

  .fix-card .fix-card-desc {
    font-size: 12px;
    color: var(--text-secondary);
    line-height: 1.5;
    margin-left: 56px;
  }

  .fix-card .fix-card-action {
    margin-top: 12px;
    margin-left: 56px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    font-weight: 600;
    color: var(--accent-2);
    cursor: pointer;
  }

  .back-btn {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    color: var(--text-primary);
    padding: 14px 24px;
    border-radius: 14px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 16px;
    transition: all 0.3s;
    width: 100%;
    justify-content: center;
  }

  .back-btn:hover { background: rgba(255,255,255,0.1); }

  .meditation-grid { display: grid; gap: 14px; }

  .med-card {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 22px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 16px;
    position: relative;
    overflow: hidden;
  }

  .med-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 4px; height: 100%;
    border-radius: 20px 0 0 20px;
  }

  .med-card:nth-child(1)::before { background: linear-gradient(to bottom, #6c5ce7, #a855f7); }
  .med-card:nth-child(2)::before { background: linear-gradient(to bottom, #06b6d4, #22d3ee); }
  .med-card:nth-child(3)::before { background: linear-gradient(to bottom, #f59e0b, #fbbf24); }
  .med-card:nth-child(4)::before { background: linear-gradient(to bottom, #10b981, #34d399); }

  .med-card:hover {
    transform: translateX(4px);
    background: rgba(255,255,255,0.08);
  }

  .med-icon {
    width: 56px; height: 56px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    flex-shrink: 0;
  }

  .med-card:nth-child(1) .med-icon { background: rgba(108,92,231,0.15); }
  .med-card:nth-child(2) .med-icon { background: rgba(6,182,212,0.15); }
  .med-card:nth-child(3) .med-icon { background: rgba(245,158,11,0.15); }
  .med-card:nth-child(4) .med-icon { background: rgba(16,185,129,0.15); }

  .med-info h3 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
  .med-info p { font-size: 12px; color: var(--text-secondary); line-height: 1.4; }
  .med-arrow { margin-left: auto; color: var(--text-secondary); font-size: 18px; }

  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(10,10,26,0.95);
    z-index: 100;
    justify-content: center;
    align-items: center;
    padding: 20px;
    animation: fadeIn 0.3s ease;
  }

  .modal-overlay.active { display: flex; }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .modal-content {
    width: 100%;
    max-width: 440px;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.4s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .modal-close {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    color: var(--text-primary);
    width: 40px; height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    cursor: pointer;
    margin-bottom: 20px;
    transition: background 0.3s;
  }

  .modal-close:hover { background: rgba(255,255,255,0.15); }

  .tratak-container { text-align: center; padding: 20px; }

  .candle-wrapper {
    position: relative;
    width: 200px; height: 300px;
    margin: 30px auto;
  }

  .candle-body {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 40px; height: 120px;
    background: linear-gradient(to bottom, #ffecd2, #f5c472, #d4a03c);
    border-radius: 6px 6px 4px 4px;
  }

  .candle-wick {
    position: absolute;
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%);
    width: 3px; height: 18px;
    background: #333;
    border-radius: 2px;
  }

  .flame-container {
    position: absolute;
    bottom: 135px;
    left: 50%;
    transform: translateX(-50%);
  }

  .flame {
    width: 24px; height: 50px;
    background: radial-gradient(ellipse at bottom, #ffd700, #ff8c00 40%, #ff4500 70%, transparent 100%);
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    animation: flicker 0.4s infinite alternate;
    position: relative;
  }

  .flame::before {
    content: '';
    position: absolute;
    width: 14px; height: 30px;
    background: radial-gradient(ellipse at bottom, #ffffcc, #ffdd44 60%, transparent 100%);
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    left: 50%; bottom: 2px;
    transform: translateX(-50%);
  }

  .flame-glow {
    position: absolute;
    width: 160px; height: 160px;
    background: radial-gradient(circle, rgba(255,200,50,0.15), transparent 70%);
    border-radius: 50%;
    left: 50%; bottom: 100px;
    transform: translateX(-50%);
    animation: glowPulse 2s infinite ease-in-out;
  }

  @keyframes flicker {
    0% { transform: skewX(-2deg) scaleY(1); }
    25% { transform: skewX(3deg) scaleY(0.95); }
    50% { transform: skewX(-1deg) scaleY(1.02); }
    75% { transform: skewX(2deg) scaleY(0.98); }
    100% { transform: skewX(-3deg) scaleY(1.01); }
  }

  @keyframes glowPulse {
    0%, 100% { opacity: 0.5; transform: translateX(-50%) scale(1); }
    50% { opacity: 0.8; transform: translateX(-50%) scale(1.1); }
  }

  .candle-wax {
    position: absolute;
    bottom: 118px;
    left: 50%;
    transform: translateX(-50%);
    width: 44px; height: 8px;
    background: #f5c472;
    border-radius: 50%;
  }

  .breathing-container { text-align: center; padding: 20px; }

  .breath-circle-wrapper {
    position: relative;
    width: 220px; height: 220px;
    margin: 40px auto;
  }

  .breath-circle {
    width: 100%; height: 100%;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(108,92,231,0.3), rgba(168,85,247,0.1));
    border: 2px solid rgba(108,92,231,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 4s ease-in-out;
    position: relative;
  }

  .breath-circle.inhale {
    transform: scale(1.3);
    border-color: rgba(6,182,212,0.6);
    background: radial-gradient(circle, rgba(6,182,212,0.3), rgba(6,182,212,0.05));
  }

  .breath-circle.hold {
    border-color: rgba(245,158,11,0.6);
    background: radial-gradient(circle, rgba(245,158,11,0.2), rgba(245,158,11,0.05));
  }

  .breath-circle.exhale {
    transform: scale(0.8);
    border-color: rgba(168,85,247,0.6);
    background: radial-gradient(circle, rgba(168,85,247,0.2), rgba(168,85,247,0.05));
  }

  .breath-text { font-size: 20px; font-weight: 700; z-index: 2; }

  .breath-rings {
    position: absolute;
    width: 100%; height: 100%;
    border: 1px solid rgba(108,92,231,0.15);
    border-radius: 50%;
    animation: ringPulse 4s infinite ease-in-out;
  }

  .breath-rings:nth-child(2) { transform: scale(1.15); animation-delay: 1s; }
  .breath-rings:nth-child(3) { transform: scale(1.3); animation-delay: 2s; }

  @keyframes ringPulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.8; }
  }

  .timer-container { text-align: center; padding: 20px; }

  .timer-options {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
  }

  .timer-opt {
    background: var(--glass);
    border: 2px solid var(--glass-border);
    color: var(--text-primary);
    padding: 12px 24px;
    border-radius: 14px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
  }

  .timer-opt.selected {
    border-color: var(--accent-1);
    background: rgba(108,92,231,0.15);
    box-shadow: 0 0 15px rgba(108,92,231,0.2);
  }

  .timer-opt:hover { border-color: var(--accent-1); }

  .control-btn {
    width: 72px; height: 72px;
    border-radius: 50%;
    border: none;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin: 0 8px;
  }

  .control-btn.play {
    background: linear-gradient(135deg, #6c5ce7, #a855f7);
    color: white;
    box-shadow: 0 4px 20px rgba(108,92,231,0.4);
  }

  .control-btn.play:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 30px rgba(108,92,231,0.5);
  }

  .control-btn.reset {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    color: var(--text-secondary);
  }

  .control-btn.reset:hover {
    color: var(--text-primary);
    background: rgba(255,255,255,0.1);
  }

  .breath-type-selector {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }

  .breath-type-btn {
    background: var(--glass);
    border: 2px solid var(--glass-border);
    color: var(--text-primary);
    padding: 10px 18px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
  }

  .breath-type-btn.selected {
    border-color: var(--accent-3);
    background: rgba(6,182,212,0.15);
  }

  /* ========== QUOTES PAGE ========== */
  .quote-display {
    text-align: center;
    padding: 40px 20px;
    min-height: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .quote-mark {
    font-size: 60px;
    line-height: 1;
    background: linear-gradient(135deg, #6c5ce7, #a855f7);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
  }

  .quote-text {
    font-size: 22px;
    font-weight: 600;
    line-height: 1.5;
    margin-bottom: 20px;
    max-width: 360px;
    animation: fadeInQuote 0.6s ease;
  }

  @keyframes fadeInQuote {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }

  .quote-author {
    font-size: 13px;
    color: var(--text-secondary);
    font-style: italic;
  }

  .new-quote-btn {
    margin-top: 30px;
    padding: 14px 32px;
    background: linear-gradient(135deg, #6c5ce7, #a855f7);
    border: none;
    border-radius: 14px;
    color: white;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
  }

  .new-quote-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(108,92,231,0.4);
  }

  /* ========== QUOTE SOURCE BADGE ========== */
  .quote-source {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-top: 14px;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .quote-source.online {
    background: rgba(46,204,113,0.12);
    color: #2ecc71;
    border: 1px solid rgba(46,204,113,0.2);
  }

  .quote-source.cached {
    background: rgba(6,182,212,0.12);
    color: #06b6d4;
    border: 1px solid rgba(6,182,212,0.2);
  }

  .quote-source.offline {
    background: rgba(243,156,18,0.12);
    color: #f39c12;
    border: 1px solid rgba(243,156,18,0.2);
  }

  .quote-source .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    animation: pulseDot 2s infinite;
  }

  .quote-source.online .dot { background: #2ecc71; }
  .quote-source.cached .dot { background: #06b6d4; }
  .quote-source.offline .dot { background: #f39c12; }

  @keyframes pulseDot {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .quote-count {
    font-size: 11px;
    color: var(--text-secondary);
    margin-top: 8px;
  }

  /* ========== LOADING SPINNER ========== */
  .quote-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--glass-border);
    border-top-color: var(--accent-2);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .loading-text {
    font-size: 13px;
    color: var(--text-secondary);
  }

  /* ========== SEARCH / FILTER ========== */
  .quote-controls {
    display: flex;
    gap: 10px;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }

  .quote-search {
    flex: 1;
    min-width: 200px;
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 12px 16px;
    color: var(--text-primary);
    font-family: 'Inter', sans-serif;
    font-size: 13px;
    outline: none;
    transition: border-color 0.3s;
  }

  .quote-search:focus { border-color: var(--accent-1); }
  .quote-search::placeholder { color: var(--text-secondary); }

  .quote-refresh-btn {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    color: var(--text-primary);
    padding: 12px 16px;
    border-radius: 12px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .quote-refresh-btn:hover { background: rgba(255,255,255,0.12); }
  .quote-refresh-btn.spinning { animation: spin 0.8s linear infinite; }

  /* ========== HISTORY PAGE ========== */
  .history-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }

  .stat-card {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 16px 10px;
    text-align: center;
  }

  .stat-number {
    font-size: 28px;
    font-weight: 800;
    background: linear-gradient(135deg, #6c5ce7, #06b6d4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .stat-label {
    font-size: 10px;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 4px;
  }

  .history-list { display: grid; gap: 10px; }

  .history-item {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 16px 18px;
    display: flex;
    align-items: center;
    gap: 14px;
    animation: fadeInPage 0.3s ease;
  }

  .history-emoji { font-size: 32px; }

  .history-info { flex: 1; }
  .history-mood { font-size: 14px; font-weight: 600; text-transform: capitalize; }

  .history-date {
    font-size: 11px;
    color: var(--text-secondary);
    margin-top: 2px;
  }

  .history-badge {
    font-size: 10px;
    padding: 4px 10px;
    border-radius: 8px;
    font-weight: 600;
  }

  .history-badge.fixed {
    background: rgba(46,204,113,0.15);
    color: #2ecc71;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-secondary);
  }

  .empty-state .empty-icon { font-size: 60px; margin-bottom: 16px; opacity: 0.5; }
  .empty-state p { font-size: 14px; }

  .clear-history-btn {
    margin-top: 20px;
    padding: 12px 24px;
    background: rgba(231,76,60,0.1);
    border: 1px solid rgba(231,76,60,0.2);
    border-radius: 12px;
    color: #e74c3c;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    width: 100%;
    transition: all 0.3s;
  }

  .clear-history-btn:hover { background: rgba(231,76,60,0.2); }

  .mood-chart {
    display: flex;
    align-items: flex-end;
    gap: 6px;
    height: 120px;
    padding: 10px 0;
    margin-bottom: 20px;
  }

  .chart-bar-wrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
    justify-content: flex-end;
  }

  .chart-bar {
    width: 100%;
    max-width: 30px;
    border-radius: 6px 6px 0 0;
    min-height: 4px;
    transition: height 0.6s ease;
  }

  .chart-label {
    font-size: 9px;
    color: var(--text-secondary);
    margin-top: 6px;
    text-align: center;
  }

  .grounding-container { padding: 20px; }

  .grounding-step {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 18px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 14px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .grounding-step.completed {
    border-color: rgba(46,204,113,0.4);
    background: rgba(46,204,113,0.08);
  }

  .grounding-num {
    width: 44px; height: 44px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 800;
    flex-shrink: 0;
  }

  .grounding-step.completed .grounding-num {
    background: linear-gradient(135deg, #10b981, #34d399);
  }

  .grounding-label { font-size: 14px; font-weight: 500; }

  .grounding-check {
    margin-left: auto;
    font-size: 18px;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .grounding-step.completed .grounding-check { opacity: 1; }

  .journal-area {
    width: 100%;
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 16px;
    color: var(--text-primary);
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    resize: vertical;
    min-height: 100px;
    outline: none;
    transition: border-color 0.3s;
  }

  .journal-area:focus { border-color: var(--accent-1); }
  .journal-area::placeholder { color: var(--text-secondary); }

  .reassurance {
    background: linear-gradient(135deg, rgba(108,92,231,0.1), rgba(6,182,212,0.1));
    border: 1px solid rgba(108,92,231,0.2);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    font-size: 15px;
    line-height: 1.6;
    color: var(--text-primary);
    margin-top: 12px;
  }

  .reassurance .reassure-icon {
    font-size: 30px;
    display: block;
    margin-bottom: 8px;
  }

  .gratitude-card {
    background: linear-gradient(135deg, rgba(46,204,113,0.1), rgba(6,182,212,0.1));
    border: 1px solid rgba(46,204,113,0.2);
    border-radius: 16px;
    padding: 20px;
    margin-top: 14px;
  }

  .gratitude-card h4 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .duration-badge {
    display: inline-block;
    font-size: 11px;
    padding: 3px 10px;
    border-radius: 8px;
    background: rgba(108,92,231,0.15);
    color: var(--accent-2);
    font-weight: 600;
    margin-left: 56px;
    margin-top: 6px;
  }

  .timer-ring-wrapper {
    position: relative;
    width: 220px; height: 220px;
    margin: 20px auto;
  }

  .timer-ring-wrapper svg { transform: rotate(-90deg); }

  .timer-ring-bg {
    fill: none;
    stroke: rgba(255,255,255,0.05);
    stroke-width: 6;
  }

  .timer-ring-progress {
    fill: none;
    stroke: url(#timerGradient);
    stroke-width: 6;
    stroke-linecap: round;
    transition: stroke-dashoffset 1s linear;
  }

  .timer-ring-text {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }

  .timer-ring-text .time {
    font-size: 52px;
    font-weight: 200;
    font-variant-numeric: tabular-nums;
  }

  .timer-ring-text .label {
    font-size: 12px;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 2px;
  }

  .bottom-nav {
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    height: var(--nav-height);
    background: rgba(10,10,26,0.9);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
    border-top: 1px solid var(--glass-border);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 50;
    padding-bottom: env(safe-area-inset-bottom);
  }

  .nav-inner {
    display: flex;
    justify-content: space-around;
    align-items: center;
    width: 100%;
    max-width: 480px;
  }

  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    padding: 8px 16px;
    border-radius: 12px;
    transition: all 0.3s;
    position: relative;
  }

  .nav-item::before {
    content: '';
    position: absolute;
    top: -1px;
    width: 30px; height: 3px;
    border-radius: 0 0 3px 3px;
    background: var(--accent-1);
    opacity: 0;
    transition: opacity 0.3s;
  }

  .nav-item.active::before { opacity: 1; }

  .nav-item .nav-icon {
    font-size: 22px;
    transition: transform 0.3s;
  }

  .nav-item.active .nav-icon { transform: translateY(-2px); }

  .nav-item .nav-label {
    font-size: 10px;
    font-weight: 600;
    color: var(--text-secondary);
    transition: color 0.3s;
    letter-spacing: 0.5px;
  }

  .nav-item.active .nav-label { color: var(--accent-2); }

  .toast {
    position: fixed;
    bottom: 90px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: rgba(46,204,113,0.9);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 600;
    z-index: 200;
    opacity: 0;
    transition: all 0.4s ease;
    pointer-events: none;
    backdrop-filter: blur(10px);
    max-width: 90%;
    text-align: center;
  }

  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 4px; }

  @media (max-width: 380px) {
    .mood-grid { grid-template-columns: repeat(2, 1fr); }
    .mood-btn.full-width { grid-column: span 2; }
    .history-stats { grid-template-columns: repeat(2, 1fr); }
    .stat-card:last-child { grid-column: span 2; }
  }
</style>
</head>
<body>

<div class="bg-particles">
  <div class="orb"></div>
  <div class="orb"></div>
  <div class="orb"></div>
</div>

<div class="toast" id="toast"></div>

<div class="app-container">

  <header class="app-header">
    <div class="logo">Fix My Mood</div>
    <div class="tagline">Your Pocket Wellness Companion</div>
  </header>

  <!-- ===== HOME ===== -->
  <section class="page active" id="page-home">
    <div class="greeting" id="greeting">Good Evening üëã</div>
    <div class="greeting-sub">How are you feeling right now?</div>

    <div id="mood-selection">
      <div class="mood-grid">
        <div class="mood-btn" data-mood="sad" onclick="selectMood(this)">
          <span class="emoji">üòî</span>
          <span class="mood-label">Sad</span>
        </div>
        <div class="mood-btn" data-mood="angry" onclick="selectMood(this)">
          <span class="emoji">üò°</span>
          <span class="mood-label">Angry</span>
        </div>
        <div class="mood-btn" data-mood="anxious" onclick="selectMood(this)">
          <span class="emoji">üò∞</span>
          <span class="mood-label">Anxious</span>
        </div>
        <div class="mood-btn" data-mood="tired" onclick="selectMood(this)">
          <span class="emoji">üò¥</span>
          <span class="mood-label">Tired</span>
        </div>
        <div class="mood-btn full-width" data-mood="normal" onclick="selectMood(this)">
          <span class="emoji">üôÇ</span>
          <span class="mood-label">Normal</span>
        </div>
      </div>
      <button class="fix-btn" id="fixBtn" disabled onclick="fixMyMood()">‚ú® Fix My Mood</button>
    </div>

    <div class="fix-result" id="fix-result"></div>
  </section>

  <!-- ===== MEDITATION ===== -->
  <section class="page" id="page-meditation">
    <div class="section-title">üßò Meditation Hub</div>
    <div class="section-subtitle">Choose a practice to calm your mind</div>

    <div class="meditation-grid">
      <div class="med-card" onclick="openTratak()">
        <div class="med-icon">üïØÔ∏è</div>
        <div class="med-info">
          <h3>Tratak Meditation</h3>
          <p>Focus on a flame to sharpen concentration</p>
        </div>
        <span class="med-arrow">‚Ä∫</span>
      </div>
      <div class="med-card" onclick="openBreathing()">
        <div class="med-icon">üå¨Ô∏è</div>
        <div class="med-info">
          <h3>Breathing Exercise</h3>
          <p>Box breathing & 4-7-8 technique</p>
        </div>
        <span class="med-arrow">‚Ä∫</span>
      </div>
      <div class="med-card" onclick="openTimerMed()">
        <div class="med-icon">‚è±Ô∏è</div>
        <div class="med-info">
          <h3>Silent Meditation</h3>
          <p>Timed silent session with bell</p>
        </div>
        <span class="med-arrow">‚Ä∫</span>
      </div>
      <div class="med-card" onclick="navigateTo('quotes')">
        <div class="med-icon">üí¨</div>
        <div class="med-info">
          <h3>Motivational Quotes</h3>
          <p>Get inspired with powerful words</p>
        </div>
        <span class="med-arrow">‚Ä∫</span>
      </div>
    </div>
  </section>

  <!-- ===== QUOTES ===== -->
  <section class="page" id="page-quotes">
    <div class="section-title">üí¨ Daily Inspiration</div>
    <div class="section-subtitle">Words that heal and empower ‚Äî fetched live from GitHub</div>

    <div class="quote-controls">
      <input type="text" class="quote-search" id="quoteSearch"
        placeholder="üîç Search quotes..." oninput="searchQuotes(this.value)">
      <button class="quote-refresh-btn" id="refreshBtn" onclick="refetchQuotes()" title="Re-fetch from GitHub">üîÑ</button>
    </div>

    <div class="glass-card quote-display" id="quoteDisplay">
      <div class="quote-loading" id="quoteLoading">
        <div class="spinner"></div>
        <div class="loading-text">Fetching quotes from GitHub...</div>
      </div>
      <div id="quoteContent" style="display:none">
        <div class="quote-mark">"</div>
        <div class="quote-text" id="quoteText">Loading...</div>
        <div class="quote-author" id="quoteAuthor"></div>
        <div class="quote-source" id="quoteSource">
          <span class="dot"></span>
          <span id="sourceLabel">Loading</span>
        </div>
        <div class="quote-count" id="quoteCount"></div>
        <button class="new-quote-btn" onclick="showRandomQuote()">‚ú® New Quote</button>
      </div>
    </div>

    <!-- Search Results -->
    <div id="searchResults" style="display:none"></div>
  </section>

  <!-- ===== HISTORY ===== -->
  <section class="page" id="page-history">
    <div class="section-title">üìä Mood History</div>
    <div class="section-subtitle">Track your emotional journey</div>

    <div class="history-stats">
      <div class="stat-card">
        <div class="stat-number" id="statTotal">0</div>
        <div class="stat-label">Total</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="statFixed">0</div>
        <div class="stat-label">Fixed</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="statStreak">0</div>
        <div class="stat-label">Streak</div>
      </div>
    </div>

    <div class="glass-card">
      <div style="font-size:13px;font-weight:600;margin-bottom:10px;color:var(--text-secondary)">MOOD DISTRIBUTION</div>
      <div class="mood-chart" id="moodChart"></div>
    </div>

    <div class="history-list" id="historyList">
      <div class="empty-state">
        <div class="empty-icon">üìù</div>
        <p>No mood entries yet.<br>Start by selecting your mood!</p>
      </div>
    </div>

    <button class="clear-history-btn" onclick="clearHistory()" id="clearBtn" style="display:none">
      üóëÔ∏è Clear All History
    </button>
  </section>
</div>

<!-- ===== BOTTOM NAV ===== -->
<nav class="bottom-nav">
  <div class="nav-inner">
    <div class="nav-item active" onclick="navigateTo('home')" data-page="home">
      <span class="nav-icon">üè†</span>
      <span class="nav-label">Home</span>
    </div>
    <div class="nav-item" onclick="navigateTo('meditation')" data-page="meditation">
      <span class="nav-icon">üßò</span>
      <span class="nav-label">Meditate</span>
    </div>
    <div class="nav-item" onclick="navigateTo('quotes')" data-page="quotes">
      <span class="nav-icon">üí¨</span>
      <span class="nav-label">Quotes</span>
    </div>
    <div class="nav-item" onclick="navigateTo('history')" data-page="history">
      <span class="nav-icon">üìä</span>
      <span class="nav-label">History</span>
    </div>
  </div>
</nav>

<!-- ===== MODALS ===== -->

<!-- Tratak -->
<div class="modal-overlay" id="modal-tratak">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('tratak')">‚úï</button>
    <div class="tratak-container">
      <h2 style="font-size:22px;font-weight:700;margin-bottom:4px">üïØÔ∏è Tratak Meditation</h2>
      <p style="color:var(--text-secondary);font-size:13px;margin-bottom:10px">Focus softly on the flame. Don't blink.</p>
      <div class="timer-options">
        <button class="timer-opt selected" onclick="setTratakTime(this,120)">2 min</button>
        <button class="timer-opt" onclick="setTratakTime(this,300)">5 min</button>
        <button class="timer-opt" onclick="setTratakTime(this,600)">10 min</button>
      </div>
      <div class="candle-wrapper">
        <div class="flame-glow"></div>
        <div class="flame-container"><div class="flame"></div></div>
        <div class="candle-wick"></div>
        <div class="candle-wax"></div>
        <div class="candle-body"></div>
      </div>
      <div style="font-size:42px;font-weight:200;margin:10px 0;font-variant-numeric:tabular-nums" id="tratakTimer">2:00</div>
      <div>
        <button class="control-btn play" onclick="toggleTratak()" id="tratakPlayBtn">‚ñ∂</button>
        <button class="control-btn reset" onclick="resetTratak()">‚Ü∫</button>
      </div>
    </div>
  </div>
</div>

<!-- Breathing -->
<div class="modal-overlay" id="modal-breathing">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('breathing')">‚úï</button>
    <div class="breathing-container">
      <h2 style="font-size:22px;font-weight:700;margin-bottom:4px">üå¨Ô∏è Breathing Exercise</h2>
      <p style="color:var(--text-secondary);font-size:13px;margin-bottom:16px">Follow the circle rhythm</p>
      <div class="breath-type-selector">
        <button class="breath-type-btn selected" onclick="setBreathType(this,'box')">Box 4-4-4-4</button>
        <button class="breath-type-btn" onclick="setBreathType(this,'relax')">Relax 4-7-8</button>
      </div>
      <div class="timer-options" style="margin-top:12px">
        <button class="timer-opt selected" onclick="setBreathDuration(this,60)">1 min</button>
        <button class="timer-opt" onclick="setBreathDuration(this,180)">3 min</button>
        <button class="timer-opt" onclick="setBreathDuration(this,300)">5 min</button>
      </div>
      <div class="breath-circle-wrapper">
        <div class="breath-rings"></div>
        <div class="breath-rings"></div>
        <div class="breath-rings"></div>
        <div class="breath-circle" id="breathCircle">
          <span class="breath-text" id="breathText">Ready</span>
        </div>
      </div>
      <div style="font-size:36px;font-weight:200;margin:10px 0;font-variant-numeric:tabular-nums" id="breathTimer">1:00</div>
      <div>
        <button class="control-btn play" onclick="toggleBreathing()" id="breathPlayBtn">‚ñ∂</button>
        <button class="control-btn reset" onclick="resetBreathing()">‚Ü∫</button>
      </div>
    </div>
  </div>
</div>

<!-- Silent Timer -->
<div class="modal-overlay" id="modal-timer">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('timer')">‚úï</button>
    <div class="timer-container">
      <h2 style="font-size:22px;font-weight:700;margin-bottom:4px">‚è±Ô∏è Silent Meditation</h2>
      <p style="color:var(--text-secondary);font-size:13px;margin-bottom:16px">Sit still. Breathe naturally. Be present.</p>
      <div class="timer-options">
        <button class="timer-opt selected" onclick="setSilentTime(this,120)">2 min</button>
        <button class="timer-opt" onclick="setSilentTime(this,300)">5 min</button>
        <button class="timer-opt" onclick="setSilentTime(this,600)">10 min</button>
      </div>
      <div class="timer-ring-wrapper">
        <svg width="220" height="220" viewBox="0 0 220 220">
          <defs>
            <linearGradient id="timerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#6c5ce7"/>
              <stop offset="100%" style="stop-color:#06b6d4"/>
            </linearGradient>
          </defs>
          <circle class="timer-ring-bg" cx="110" cy="110" r="100"/>
          <circle class="timer-ring-progress" id="timerProgress" cx="110" cy="110" r="100"
            stroke-dasharray="628.32" stroke-dashoffset="0"/>
        </svg>
        <div class="timer-ring-text">
          <div class="time" id="silentTimerDisplay">2:00</div>
          <div class="label" id="silentTimerLabel">READY</div>
        </div>
      </div>
      <div>
        <button class="control-btn play" onclick="toggleSilentTimer()" id="silentPlayBtn">‚ñ∂</button>
        <button class="control-btn reset" onclick="resetSilentTimer()">‚Ü∫</button>
      </div>
    </div>
  </div>
</div>

<!-- Grounding -->
<div class="modal-overlay" id="modal-grounding">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal('grounding')">‚úï</button>
    <div class="grounding-container">
      <h2 style="font-size:22px;font-weight:700;margin-bottom:4px;text-align:center">üåø 5-4-3-2-1 Grounding</h2>
      <p style="color:var(--text-secondary);font-size:13px;margin-bottom:24px;text-align:center">Tap each step as you complete it</p>
      <div class="grounding-step" onclick="completeGrounding(this)">
        <div class="grounding-num">5</div>
        <div class="grounding-label">Name <strong>5 things</strong> you can <strong>SEE</strong> üëÄ</div>
        <div class="grounding-check">‚úÖ</div>
      </div>
      <div class="grounding-step" onclick="completeGrounding(this)">
        <div class="grounding-num">4</div>
        <div class="grounding-label">Name <strong>4 things</strong> you can <strong>TOUCH</strong> ‚úã</div>
        <div class="grounding-check">‚úÖ</div>
      </div>
      <div class="grounding-step" onclick="completeGrounding(this)">
        <div class="grounding-num">3</div>
        <div class="grounding-label">Name <strong>3 things</strong> you can <strong>HEAR</strong> üëÇ</div>
        <div class="grounding-check">‚úÖ</div>
      </div>
      <div class="grounding-step" onclick="completeGrounding(this)">
        <div class="grounding-num">2</div>
        <div class="grounding-label">Name <strong>2 things</strong> you can <strong>SMELL</strong> üëÉ</div>
        <div class="grounding-check">‚úÖ</div>
      </div>
      <div class="grounding-step" onclick="completeGrounding(this)">
        <div class="grounding-num">1</div>
        <div class="grounding-label">Name <strong>1 thing</strong> you can <strong>TASTE</strong> üëÖ</div>
        <div class="grounding-check">‚úÖ</div>
      </div>
      <div class="reassurance" id="groundingComplete" style="display:none">
        <span class="reassure-icon">üéâ</span>
        You're grounded. You're here. You're safe.<br>
        <strong>This moment is all that matters.</strong>
      </div>
    </div>
  </div>
</div>

<script>
// ==========================================
// üì¶ DATA & CONFIG
// ==========================================

const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/JamesFT/Database-Quotes-JSON/master/quotes.json';
const CACHE_KEY = 'fmm_quotes_cache';
const CACHE_TIME_KEY = 'fmm_quotes_cache_time';
const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours

const moodEmojis = { sad:'üòî', angry:'üò°', anxious:'üò∞', tired:'üò¥', normal:'üôÇ' };
const moodColors = { sad:'#5b9bd5', angry:'#e74c3c', anxious:'#f39c12', tired:'#8e8e93', normal:'#2ecc71' };

// Hardcoded fallback quotes (used when offline + no cache)
const fallbackQuotes = [
  { quoteText:"This feeling is temporary.", quoteAuthor:"Unknown" },
  { quoteText:"You survived 100% of your worst days.", quoteAuthor:"Unknown" },
  { quoteText:"Calm mind = Strong decisions.", quoteAuthor:"Unknown" },
  { quoteText:"Breathe. You're going to be okay.", quoteAuthor:"Unknown" },
  { quoteText:"Stars can't shine without darkness.", quoteAuthor:"D.H. Sidebottom" },
  { quoteText:"You are stronger than you think.", quoteAuthor:"A.A. Milne" },
  { quoteText:"Feelings are visitors. Let them come and go.", quoteAuthor:"Mooji" },
  { quoteText:"The only way out is through.", quoteAuthor:"Robert Frost" },
  { quoteText:"Be gentle with yourself.", quoteAuthor:"Unknown" },
  { quoteText:"Every storm runs out of rain.", quoteAuthor:"Maya Angelou" },
  { quoteText:"Inhale courage. Exhale fear.", quoteAuthor:"Unknown" },
  { quoteText:"It's okay to not be okay.", quoteAuthor:"Unknown" },
  { quoteText:"Healing is not linear.", quoteAuthor:"Unknown" },
  { quoteText:"Rest is not quitting. It's recharging.", quoteAuthor:"Unknown" },
  { quoteText:"You are not your thoughts.", quoteAuthor:"Eckhart Tolle" },
  { quoteText:"Progress, not perfection.", quoteAuthor:"Unknown" },
  { quoteText:"Don't believe everything you think.", quoteAuthor:"Unknown" },
  { quoteText:"Self-care is not selfish.", quoteAuthor:"Unknown" },
  { quoteText:"You are enough just as you are.", quoteAuthor:"Meghan Markle" },
  { quoteText:"Peace begins with a pause.", quoteAuthor:"Unknown" },
];

// ==========================================
// üß† STATE
// ==========================================
let selectedMood = null;
let moodHistory = JSON.parse(localStorage.getItem('fmm_history') || '[]');
let allQuotes = [];
let filteredQuotes = [];
let lastQuoteIndex = -1;
let quoteSource = 'loading'; // 'online' | 'cached' | 'offline'

// Timers
let tratakTotalTime=120, tratakRemaining=120, tratakInterval=null, tratakRunning=false;
let breathType='box', breathDuration=60, breathRemaining=60, breathInterval=null, breathRunning=false, breathPhaseInterval=null;
let silentTotalTime=120, silentRemaining=120, silentInterval=null, silentRunning=false;

// ==========================================
// üîä AUDIO
// ==========================================
let audioCtx = null;
function getAudioCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

function playBell() {
  const ctx = getAudioCtx();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain); gain.connect(ctx.destination);
  osc.type = 'sine';
  osc.frequency.setValueAtTime(528, ctx.currentTime);
  gain.gain.setValueAtTime(0.3, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 2.5);
  osc.start(ctx.currentTime); osc.stop(ctx.currentTime + 2.5);
}

function playSoftTick() {
  const ctx = getAudioCtx();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain); gain.connect(ctx.destination);
  osc.type = 'sine';
  osc.frequency.setValueAtTime(440, ctx.currentTime);
  gain.gain.setValueAtTime(0.08, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
  osc.start(ctx.currentTime); osc.stop(ctx.currentTime + 0.15);
}

// ==========================================
// üåê QUOTE FETCHING SYSTEM
// ==========================================

async function fetchQuotes() {
  showQuoteLoading(true);

  // 1) Try to load from fresh cache first
  const cached = loadFromCache();
  if (cached) {
    allQuotes = cached;
    filteredQuotes = [...allQuotes];
    quoteSource = 'cached';
    showQuoteLoading(false);
    showRandomQuote();
    updateSourceBadge();
    console.log(`üì¶ Loaded ${allQuotes.length} quotes from cache`);

    // Still try to refresh in background if cache is old
    const cacheTime = parseInt(localStorage.getItem(CACHE_TIME_KEY) || '0');
    if (Date.now() - cacheTime > CACHE_DURATION) {
      fetchFromGitHub(true); // silent background refresh
    }
    return;
  }

  // 2) Fetch from GitHub
  const success = await fetchFromGitHub(false);

  // 3) If failed, use fallback
  if (!success) {
    allQuotes = [...fallbackQuotes];
    filteredQuotes = [...allQuotes];
    quoteSource = 'offline';
    showQuoteLoading(false);
    showRandomQuote();
    updateSourceBadge();
    console.log(`‚ö†Ô∏è Using ${fallbackQuotes.length} offline fallback quotes`);
  }
}

async function fetchFromGitHub(silent = false) {
  try {
    if (!silent) showQuoteLoading(true);

    const response = await fetch(GITHUB_RAW_URL, {
      method: 'GET',
      headers: { 'Accept': 'application/json' },
      signal: AbortSignal.timeout(10000) // 10s timeout
    });

    if (!response.ok) throw new Error(`HTTP ${response.status}`);

    const data = await response.json();

    // Filter out quotes with empty text
    const validQuotes = data.filter(q =>
      q.quoteText && q.quoteText.trim().length > 0
    );

    if (validQuotes.length === 0) throw new Error('No valid quotes');

    allQuotes = validQuotes;
    filteredQuotes = [...allQuotes];
    quoteSource = 'online';

    // Save to cache
    saveToCache(validQuotes);

    if (!silent) {
      showQuoteLoading(false);
      showRandomQuote();
    }

    updateSourceBadge();
    showToast(`‚úÖ Fetched ${validQuotes.length} quotes from GitHub!`);
    console.log(`üåê Fetched ${validQuotes.length} quotes from GitHub`);
    return true;

  } catch (error) {
    console.error('‚ùå GitHub fetch failed:', error.message);
    if (!silent) {
      showToast(`‚ö†Ô∏è Fetch failed: ${error.message}. Using fallback.`);
    }
    return false;
  }
}

function saveToCache(quotes) {
  try {
    localStorage.setItem(CACHE_KEY, JSON.stringify(quotes));
    localStorage.setItem(CACHE_TIME_KEY, Date.now().toString());
    console.log(`üíæ Cached ${quotes.length} quotes`);
  } catch (e) {
    console.warn('Cache save failed (storage full?):', e);
  }
}

function loadFromCache() {
  try {
    const data = localStorage.getItem(CACHE_KEY);
    if (!data) return null;
    const quotes = JSON.parse(data);
    if (!Array.isArray(quotes) || quotes.length === 0) return null;
    return quotes;
  } catch (e) {
    return null;
  }
}

async function refetchQuotes() {
  const btn = document.getElementById('refreshBtn');
  btn.classList.add('spinning');
  btn.disabled = true;

  // Clear cache to force fresh fetch
  localStorage.removeItem(CACHE_KEY);
  localStorage.removeItem(CACHE_TIME_KEY);

  const success = await fetchFromGitHub(false);

  if (!success) {
    // Try cache one more time, else fallback
    const cached = loadFromCache();
    if (cached) {
      allQuotes = cached;
      filteredQuotes = [...allQuotes];
      quoteSource = 'cached';
    } else {
      allQuotes = [...fallbackQuotes];
      filteredQuotes = [...allQuotes];
      quoteSource = 'offline';
    }
    showQuoteLoading(false);
    showRandomQuote();
    updateSourceBadge();
  }

  btn.classList.remove('spinning');
  btn.disabled = false;
}

// ==========================================
// üí¨ QUOTE DISPLAY
// ==========================================

function showQuoteLoading(show) {
  document.getElementById('quoteLoading').style.display = show ? 'flex' : 'none';
  document.getElementById('quoteContent').style.display = show ? 'none' : 'block';
}

function showRandomQuote() {
  const pool = filteredQuotes.length > 0 ? filteredQuotes : allQuotes;
  if (pool.length === 0) return;

  let idx;
  do {
    idx = Math.floor(Math.random() * pool.length);
  } while (idx === lastQuoteIndex && pool.length > 1);
  lastQuoteIndex = idx;

  const q = pool[idx];
  const textEl = document.getElementById('quoteText');
  const authorEl = document.getElementById('quoteAuthor');

  // Trigger animation
  textEl.style.animation = 'none';
  textEl.offsetHeight;
  textEl.style.animation = 'fadeInQuote 0.6s ease';

  textEl.textContent = q.quoteText;
  authorEl.textContent = q.quoteAuthor ? `‚Äî ${q.quoteAuthor}` : '‚Äî Unknown';

  document.getElementById('quoteCount').textContent =
    `${pool.length.toLocaleString()} quotes available`;
}

function updateSourceBadge() {
  const badge = document.getElementById('quoteSource');
  const label = document.getElementById('sourceLabel');

  badge.className = 'quote-source ' + quoteSource;

  const labels = {
    online: 'üåê Live from GitHub',
    cached: 'üíæ Cached (Offline Ready)',
    offline: 'üì¥ Offline Fallback'
  };
  label.textContent = labels[quoteSource] || 'Unknown';
}

function searchQuotes(query) {
  const resultsEl = document.getElementById('searchResults');
  query = query.trim().toLowerCase();

  if (!query) {
    filteredQuotes = [...allQuotes];
    resultsEl.style.display = 'none';
    document.getElementById('quoteDisplay').style.display = '';
    showRandomQuote();
    return;
  }

  filteredQuotes = allQuotes.filter(q =>
    q.quoteText.toLowerCase().includes(query) ||
    (q.quoteAuthor && q.quoteAuthor.toLowerCase().includes(query))
  );

  if (filteredQuotes.length === 0) {
    document.getElementById('quoteDisplay').style.display = 'none';
    resultsEl.style.display = 'block';
    resultsEl.innerHTML = `
      <div class="glass-card" style="text-align:center;padding:40px">
        <div style="font-size:40px;margin-bottom:12px">üîç</div>
        <p style="color:var(--text-secondary)">No quotes found for "<strong>${query}</strong>"</p>
      </div>`;
    return;
  }

  // Show matching quotes as a list
  document.getElementById('quoteDisplay').style.display = 'none';
  resultsEl.style.display = 'block';

  let html = `<div style="font-size:12px;color:var(--text-secondary);margin-bottom:12px;font-weight:600">${filteredQuotes.length} RESULTS</div>`;
  filteredQuotes.slice(0, 15).forEach(q => {
    const highlighted = q.quoteText.replace(
      new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`, 'gi'),
      '<mark style="background:rgba(168,85,247,0.3);color:white;padding:1px 3px;border-radius:3px">$1</mark>'
    );
    html += `
      <div class="glass-card" style="padding:16px;margin-bottom:8px;cursor:pointer"
        onclick="document.getElementById('quoteSearch').value='';searchQuotes('');">
        <div style="font-size:14px;line-height:1.5;margin-bottom:6px">"${highlighted}"</div>
        <div style="font-size:11px;color:var(--text-secondary);font-style:italic">‚Äî ${q.quoteAuthor || 'Unknown'}</div>
      </div>`;
  });

  if (filteredQuotes.length > 15) {
    html += `<p style="text-align:center;color:var(--text-secondary);font-size:12px;padding:10px">+ ${filteredQuotes.length - 15} more results</p>`;
  }

  resultsEl.innerHTML = html;
}

// ==========================================
// üß≠ NAVIGATION
// ==========================================

function navigateTo(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.querySelector(`.nav-item[data-page="${page}"]`).classList.add('active');
  if (page === 'history') renderHistory();
  if (page === 'home') resetHomeView();
}

// ==========================================
// üè† HOME
// ==========================================

function updateGreeting() {
  const hour = new Date().getHours();
  let g = 'Good Evening üåô';
  if (hour < 12) g = 'Good Morning ‚òÄÔ∏è';
  else if (hour < 17) g = 'Good Afternoon üå§Ô∏è';
  document.getElementById('greeting').textContent = g;
}

function selectMood(el) {
  document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  selectedMood = el.dataset.mood;
  document.getElementById('fixBtn').disabled = false;
}

function resetHomeView() {
  document.getElementById('mood-selection').style.display = 'block';
  const r = document.getElementById('fix-result');
  r.classList.remove('active'); r.innerHTML = '';
  document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
  selectedMood = null;
  document.getElementById('fixBtn').disabled = true;
}

function fixMyMood() {
  if (!selectedMood) return;
  moodHistory.unshift({
    mood: selectedMood,
    emoji: moodEmojis[selectedMood],
    timestamp: Date.now(),
    fixed: true
  });
  localStorage.setItem('fmm_history', JSON.stringify(moodHistory));
  document.getElementById('mood-selection').style.display = 'none';
  const result = document.getElementById('fix-result');
  result.innerHTML = getMoodFixHTML(selectedMood);
  result.classList.add('active');
  showToast('Mood logged! Let\'s fix it üí™');
}

function getMoodFixHTML(mood) {
  const fixes = {
    sad: `
      <div class="fix-header"><span class="fix-emoji">üòî</span><h2>It's Okay to Feel Sad</h2><p>Here are some things to help</p></div>
      <div class="fix-card" onclick="openBreathing()">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(91,155,213,0.15)">üå¨Ô∏è</div><div class="fix-card-title">Calming Breathing</div></div>
        <div class="fix-card-desc">3 minutes of slow, deep breathing</div><div class="duration-badge">3 min</div><div class="fix-card-action">Start ‚Üí</div>
      </div>
      <div class="fix-card" onclick="navigateTo('quotes')">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(168,85,247,0.15)">üíú</div><div class="fix-card-title">Motivational Quote</div></div>
        <div class="fix-card-desc">Read something uplifting</div><div class="fix-card-action">Read Quote ‚Üí</div>
      </div>
      <div class="gratitude-card"><h4>üôè Gratitude Moment</h4><textarea class="journal-area" placeholder="Write one thing you're grateful for..." rows="3"></textarea></div>
      <div class="reassurance"><span class="reassure-icon">üíô</span>Sadness is natural. Allow yourself to feel, then gently let go.</div>
      <button class="back-btn" onclick="resetHomeView()">‚Üê Back</button>`,
    angry: `
      <div class="fix-header"><span class="fix-emoji">üò°</span><h2>Let's Cool Down</h2><p>Release the tension step by step</p></div>
      <div class="fix-card" onclick="openBreathing()">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(231,76,60,0.15)">üì¶</div><div class="fix-card-title">Box Breathing</div></div>
        <div class="fix-card-desc">1 minute to regulate your nervous system</div><div class="duration-badge">1 min</div><div class="fix-card-action">Start ‚Üí</div>
      </div>
      <div class="fix-card" onclick="openTimerMed()">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(6,182,212,0.15)">üéµ</div><div class="fix-card-title">Calming Silence</div></div>
        <div class="fix-card-desc">2 minutes of silent meditation</div><div class="duration-badge">2 min</div><div class="fix-card-action">Start ‚Üí</div>
      </div>
      <div class="gratitude-card" style="background:linear-gradient(135deg,rgba(231,76,60,0.1),rgba(243,156,18,0.1));border-color:rgba(231,76,60,0.2)">
        <h4>üìù Release It</h4><textarea class="journal-area" placeholder="Write what triggered you..." rows="4"></textarea>
      </div>
      <div class="reassurance"><span class="reassure-icon">üßä</span>Anger is energy. Channel it wisely. You're choosing calm ‚Äî that takes strength.</div>
      <button class="back-btn" onclick="resetHomeView()">‚Üê Back</button>`,
    anxious: `
      <div class="fix-header"><span class="fix-emoji">üò∞</span><h2>You're Safe Right Now</h2><p>Let's bring you back to the present</p></div>
      <div class="fix-card" onclick="openGrounding()">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(243,156,18,0.15)">üåø</div><div class="fix-card-title">5-4-3-2-1 Grounding</div></div>
        <div class="fix-card-desc">Anchor yourself in the present moment</div><div class="fix-card-action">Start ‚Üí</div>
      </div>
      <div class="fix-card" onclick="openBreathing()">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(108,92,231,0.15)">üå¨Ô∏è</div><div class="fix-card-title">Slow Breathing</div></div>
        <div class="fix-card-desc">4-7-8 breathing for calm</div><div class="duration-badge">3 min</div><div class="fix-card-action">Start ‚Üí</div>
      </div>
      <div class="reassurance"><span class="reassure-icon">üõ°Ô∏è</span>Your anxiety is lying to you. You are not in danger.<br><strong>You are safe. You are here. You are okay.</strong></div>
      <button class="back-btn" onclick="resetHomeView()">‚Üê Back</button>`,
    tired: `
      <div class="fix-header"><span class="fix-emoji">üò¥</span><h2>Rest Is Productive</h2><p>Your body is asking for a pause</p></div>
      <div class="fix-card" onclick="openTimerMed()">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(142,142,147,0.15)">üßò</div><div class="fix-card-title">Power Rest</div></div>
        <div class="fix-card-desc">5 minutes of silent rest to recharge</div><div class="duration-badge">5 min</div><div class="fix-card-action">Start ‚Üí</div>
      </div>
      <div class="fix-card" onclick="openBreathing()">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(6,182,212,0.15)">üå¨Ô∏è</div><div class="fix-card-title">Energizing Breath</div></div>
        <div class="fix-card-desc">Quick breathing to boost alertness</div><div class="duration-badge">2 min</div><div class="fix-card-action">Start ‚Üí</div>
      </div>
      <div class="fix-card" onclick="navigateTo('quotes')">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(168,85,247,0.15)">‚ö°</div><div class="fix-card-title">Motivation Boost</div></div>
        <div class="fix-card-desc">Powerful words to reignite your fire</div><div class="fix-card-action">Get Inspired ‚Üí</div>
      </div>
      <div class="reassurance"><span class="reassure-icon">üîã</span>Rest is not quitting ‚Äî it's recharging. Take this break. You've earned it.</div>
      <button class="back-btn" onclick="resetHomeView()">‚Üê Back</button>`,
    normal: `
      <div class="fix-header"><span class="fix-emoji">üôÇ</span><h2>You're Doing Great!</h2><p>Let's make this even better</p></div>
      <div class="fix-card" onclick="openTratak()">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(46,204,113,0.15)">üïØÔ∏è</div><div class="fix-card-title">Tratak Focus</div></div>
        <div class="fix-card-desc">Enhance concentration and inner calm</div><div class="duration-badge">5 min</div><div class="fix-card-action">Start ‚Üí</div>
      </div>
      <div class="fix-card" onclick="openTimerMed()">
        <div class="fix-card-header"><div class="fix-icon" style="background:rgba(108,92,231,0.15)">üßò</div><div class="fix-card-title">Mindful Meditation</div></div>
        <div class="fix-card-desc">Deepen your peace with silence</div><div class="duration-badge">5 min</div><div class="fix-card-action">Start ‚Üí</div>
      </div>
      <div class="gratitude-card"><h4>üåü Amplify Good Mood</h4><textarea class="journal-area" placeholder="What made you feel good today?" rows="3"></textarea></div>
      <div class="reassurance"><span class="reassure-icon">‚ú®</span>Feeling normal is wonderful. Appreciate this calm ‚Äî it's your strength.</div>
      <button class="back-btn" onclick="resetHomeView()">‚Üê Back</button>`
  };
  return fixes[mood] || '';
}

// ==========================================
// üìä HISTORY
// ==========================================

function renderHistory() {
  const list = document.getElementById('historyList');
  const clearBtn = document.getElementById('clearBtn');
  if (moodHistory.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="empty-icon">üìù</div><p>No mood entries yet.<br>Start by selecting your mood!</p></div>`;
    clearBtn.style.display = 'none';
  } else {
    let html = '';
    moodHistory.slice(0, 20).forEach(entry => {
      const d = new Date(entry.timestamp);
      html += `<div class="history-item">
        <span class="history-emoji">${entry.emoji}</span>
        <div class="history-info">
          <div class="history-mood">${entry.mood}</div>
          <div class="history-date">${d.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})} at ${d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'})}</div>
        </div>
        <span class="history-badge fixed">Fixed ‚úì</span>
      </div>`;
    });
    list.innerHTML = html;
    clearBtn.style.display = 'block';
  }
  document.getElementById('statTotal').textContent = moodHistory.length;
  document.getElementById('statFixed').textContent = moodHistory.filter(e => e.fixed).length;
  // Streak
  let streak = 0;
  const uniqueDays = [...new Set(moodHistory.map(e => new Date(e.timestamp).toDateString()))].sort((a,b) => new Date(b)-new Date(a));
  for (let i = 0; i < uniqueDays.length; i++) {
    const exp = new Date(); exp.setDate(exp.getDate() - i);
    if (uniqueDays[i] === exp.toDateString()) streak++; else break;
  }
  document.getElementById('statStreak').textContent = streak;
  renderMoodChart();
}

function renderMoodChart() {
  const counts = { sad:0, angry:0, anxious:0, tired:0, normal:0 };
  moodHistory.forEach(e => { if (counts[e.mood] !== undefined) counts[e.mood]++; });
  const max = Math.max(...Object.values(counts), 1);
  let html = '';
  Object.keys(counts).forEach(mood => {
    const h = (counts[mood]/max)*100;
    html += `<div class="chart-bar-wrapper">
      <div class="chart-bar" style="height:${Math.max(h,4)}%;background:${moodColors[mood]}"></div>
      <div class="chart-label">${moodEmojis[mood]}<br>${counts[mood]}</div>
    </div>`;
  });
  document.getElementById('moodChart').innerHTML = html;
}

function clearHistory() {
  if (confirm('Clear all mood history?')) {
    moodHistory = [];
    localStorage.setItem('fmm_history', '[]');
    renderHistory();
    showToast('History cleared');
  }
}

// ==========================================
// üîî TOAST
// ==========================================

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ==========================================
// ü™ü MODALS
// ==========================================

function openTratak() { document.getElementById('modal-tratak').classList.add('active'); }
function openBreathing() { document.getElementById('modal-breathing').classList.add('active'); }
function openTimerMed() { document.getElementById('modal-timer').classList.add('active'); }
function openGrounding() {
  document.getElementById('modal-grounding').classList.add('active');
  document.querySelectorAll('.grounding-step').forEach(s => s.classList.remove('completed'));
  document.getElementById('groundingComplete').style.display = 'none';
}

function closeModal(name) {
  document.getElementById('modal-' + name).classList.remove('active');
  if (name === 'tratak') resetTratak();
  if (name === 'breathing') resetBreathing();
  if (name === 'timer') resetSilentTimer();
}

function formatTime(s) {
  return `${Math.floor(s/60)}:${(s%60).toString().padStart(2,'0')}`;
}

// ==========================================
// üïØÔ∏è TRATAK
// ==========================================

function setTratakTime(btn, sec) {
  document.querySelectorAll('#modal-tratak .timer-opt').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  tratakTotalTime = sec; resetTratak();
}

function toggleTratak() {
  if (tratakRunning) {
    clearInterval(tratakInterval); tratakRunning = false;
    document.getElementById('tratakPlayBtn').textContent = '‚ñ∂';
  } else {
    tratakRunning = true;
    document.getElementById('tratakPlayBtn').textContent = '‚è∏';
    playBell();
    tratakInterval = setInterval(() => {
      tratakRemaining--;
      document.getElementById('tratakTimer').textContent = formatTime(tratakRemaining);
      if (tratakRemaining <= 0) {
        clearInterval(tratakInterval); tratakRunning = false;
        document.getElementById('tratakPlayBtn').textContent = '‚ñ∂';
        playBell(); showToast('Tratak complete! üïØÔ∏è');
      }
    }, 1000);
  }
}

function resetTratak() {
  clearInterval(tratakInterval); tratakRunning = false;
  tratakRemaining = tratakTotalTime;
  document.getElementById('tratakTimer').textContent = formatTime(tratakTotalTime);
  document.getElementById('tratakPlayBtn').textContent = '‚ñ∂';
}

// ==========================================
// üå¨Ô∏è BREATHING
// ==========================================

function setBreathType(btn, type) {
  document.querySelectorAll('.breath-type-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  breathType = type; resetBreathing();
}

function setBreathDuration(btn, sec) {
  document.querySelectorAll('#modal-breathing .timer-opt').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  breathDuration = sec; resetBreathing();
}

function toggleBreathing() {
  if (breathRunning) stopBreathing(); else startBreathing();
}

function startBreathing() {
  breathRunning = true;
  document.getElementById('breathPlayBtn').textContent = '‚è∏';
  playBell();
  const circle = document.getElementById('breathCircle');
  const text = document.getElementById('breathText');
  let phases = breathType === 'box'
    ? [{name:'Inhale',duration:4,class:'inhale'},{name:'Hold',duration:4,class:'hold'},{name:'Exhale',duration:4,class:'exhale'},{name:'Hold',duration:4,class:'hold'}]
    : [{name:'Inhale',duration:4,class:'inhale'},{name:'Hold',duration:7,class:'hold'},{name:'Exhale',duration:8,class:'exhale'}];
  let phaseIdx = 0;

  function runPhase() {
    if (!breathRunning) return;
    const phase = phases[phaseIdx % phases.length];
    circle.className = 'breath-circle ' + phase.class;
    circle.style.transition = `transform ${phase.duration}s ease-in-out`;
    text.textContent = phase.name;
    let pt = phase.duration;
    const pc = setInterval(() => {
      if (!breathRunning) { clearInterval(pc); return; }
      pt--;
      if (pt <= 0) { clearInterval(pc); phaseIdx++; playSoftTick(); runPhase(); }
    }, 1000);
    breathPhaseInterval = pc;
  }
  runPhase();

  breathInterval = setInterval(() => {
    breathRemaining--;
    document.getElementById('breathTimer').textContent = formatTime(breathRemaining);
    if (breathRemaining <= 0) {
      stopBreathing(); playBell(); showToast('Breathing complete! üå¨Ô∏è');
    }
  }, 1000);
}

function stopBreathing() {
  breathRunning = false;
  clearInterval(breathInterval); clearInterval(breathPhaseInterval);
  document.getElementById('breathPlayBtn').textContent = '‚ñ∂';
  const c = document.getElementById('breathCircle');
  c.className = 'breath-circle'; c.style.transition = 'transform 0.5s ease';
  document.getElementById('breathText').textContent = 'Paused';
}

function resetBreathing() {
  stopBreathing(); breathRemaining = breathDuration;
  document.getElementById('breathTimer').textContent = formatTime(breathDuration);
  document.getElementById('breathText').textContent = 'Ready';
}

// ==========================================
// ‚è±Ô∏è SILENT TIMER
// ==========================================

function setSilentTime(btn, sec) {
  document.querySelectorAll('#modal-timer .timer-opt').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  silentTotalTime = sec; resetSilentTimer();
}

function toggleSilentTimer() {
  if (silentRunning) {
    clearInterval(silentInterval); silentRunning = false;
    document.getElementById('silentPlayBtn').textContent = '‚ñ∂';
    document.getElementById('silentTimerLabel').textContent = 'PAUSED';
  } else {
    silentRunning = true;
    document.getElementById('silentPlayBtn').textContent = '‚è∏';
    document.getElementById('silentTimerLabel').textContent = 'MEDITATING';
    playBell();
    silentInterval = setInterval(() => {
      silentRemaining--;
      document.getElementById('silentTimerDisplay').textContent = formatTime(silentRemaining);
      const circ = 2 * Math.PI * 100;
      document.getElementById('timerProgress').style.strokeDashoffset = -((silentTotalTime - silentRemaining) / silentTotalTime) * circ;
      if (silentRemaining <= 0) {
        clearInterval(silentInterval); silentRunning = false;
        document.getElementById('silentPlayBtn').textContent = '‚ñ∂';
        document.getElementById('silentTimerLabel').textContent = 'COMPLETE';
        playBell(); setTimeout(playBell, 1500);
        showToast('Meditation complete! üßò');
      }
    }, 1000);
  }
}

function resetSilentTimer() {
  clearInterval(silentInterval); silentRunning = false;
  silentRemaining = silentTotalTime;
  document.getElementById('silentTimerDisplay').textContent = formatTime(silentTotalTime);
  document.getElementById('silentPlayBtn').textContent = '‚ñ∂';
  document.getElementById('silentTimerLabel').textContent = 'READY';
  document.getElementById('timerProgress').style.strokeDashoffset = 0;
}

// ==========================================
// üåø GROUNDING
// ==========================================

function completeGrounding(el) {
  el.classList.toggle('completed'); playSoftTick();
  const all = document.querySelectorAll('.grounding-step');
  const done = document.querySelectorAll('.grounding-step.completed');
  if (done.length === all.length) {
    document.getElementById('groundingComplete').style.display = 'block';
    playBell(); showToast('You\'re grounded! üåø');
  }
}

// ==========================================
// üöÄ INIT
// ==========================================

updateGreeting();
renderHistory();
fetchQuotes(); // <-- Dynamic fetch on load!
</script>
    <button onclick="goToChat()">Go to Chat</button>
</body>
</html>